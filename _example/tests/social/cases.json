[
  {
    "name": "Basic User (Single Service)",
    "query": "query GetUser($id: ID!) { user(id: $id) { id name } }",
    "variables": { "id": "user1" },
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice"
      }
    }
  },
  {
    "name": "User with Posts (Federation Extension)",
    "query": "query UserWithPosts($id: ID!) { user(id: $id) { id name posts { id title } } }",
    "variables": { "id": "user1" },
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice",
        "posts": [
          {
            "id": "post1",
            "title": "My First Post"
          }
        ]
      }
    }
  },
  {
    "name": "Post with Author Reference",
    "query": "query GetPost($id: ID!) { user(id: $id) { posts { id title author { id name } } } }",
    "variables": { "id": "user1" },
    "expected": {
      "user": {
        "posts": [
          {
            "id": "post1",
            "title": "My First Post",
            "author": {
              "id": "user1",
              "name": "Alice"
            }
          }
        ]
      }
    }
  },
  {
    "name": "Post with Comments (Multi-Service Chain)",
    "query": "query PostWithComments($userId: ID!) { user(id: $userId) { posts { id title comments { id body author { id name } } } } }",
    "variables": { "userId": "user1" },
    "expected": {
      "user": {
        "posts": [
          {
            "id": "post1",
            "title": "My First Post",
            "comments": [
              {
                "id": "comment1",
                "body": "Great post!",
                "author": {
                  "id": "user2",
                  "name": "Bob"
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "name": "Typename Check (Cross-Service Metadata)",
    "query": "query TypenameCheck($id: ID!) { user(id: $id) { __typename id name posts { __typename id title comments { __typename body } } } }",
    "variables": { "id": "user1" },
    "expected": {
      "user": {
        "__typename": "User",
        "id": "user1",
        "name": "Alice",
        "posts": [
          {
            "__typename": "Post",
            "id": "post1",
            "title": "My First Post",
            "comments": [
              {
                "__typename": "Comment",
                "body": "Great post!"
              }
            ]
          }
        ]
      }
    }
  },
  {
    "name": "Federation Feature: Fragment Spread",
    "description": "Verify fragment spread support with named fragments",
    "query": "query { user(id: \"user1\") { ...UserFields } } fragment UserFields on User { id name posts { id title } }",
    "variables": {},
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice",
        "posts": [
          {
            "id": "post1",
            "title": "My First Post"
          }
        ]
      }
    }
  },
  {
    "name": "Federation Feature: Inline Fragments",
    "description": "Verify inline fragment support",
    "query": "query { user(id: \"user1\") { id ... on User { name posts { id title } } } }",
    "variables": {},
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice",
        "posts": [
          {
            "id": "post1",
            "title": "My First Post"
          }
        ]
      }
    }
  },
  {
    "name": "Federation Feature: Nested Fragments",
    "description": "Verify nested fragment expansion (fragments referencing other fragments)",
    "query": "query { user(id: \"user1\") { ...UserWithPosts } } fragment UserWithPosts on User { ...BasicUser posts { ...PostInfo } } fragment BasicUser on User { id name } fragment PostInfo on Post { id title }",
    "variables": {},
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice",
        "posts": [
          {
            "id": "post1",
            "title": "My First Post"
          }
        ]
      }
    }
  },
  {
    "name": "Federation v2: @requires - Engagement Score Computation",
    "description": "Verify that @requires automatically fetches likeCount field for engagementScore calculation",
    "query": "query { user(id: \"user1\") { posts { id title engagementScore } } }",
    "variables": {},
    "expected": {
      "user": {
        "posts": [
          {
            "id": "post1",
            "title": "My First Post",
            "engagementScore": 10
          }
        ]
      }
    }
  },
  {
    "name": "Federation v2: @inaccessible - Should block access to email",
    "description": "Verify that @inaccessible field cannot be queried",
    "query": "query { user(id: \"user1\") { id name email } }",
    "variables": {},
    "expectedError": true,
    "expectedErrorMessage": "Cannot query field \"email\" on type \"User\""
  },
  {
    "name": "Federation v2: @tag - Fields with tags should work normally",
    "description": "Verify that @tag fields can be queried (tags are metadata)",
    "query": "query { user(id: \"user1\") { id name } }",
    "variables": {},
    "expected": {
      "user": {
        "id": "user1",
        "name": "Alice"
      }
    }
  }
]
