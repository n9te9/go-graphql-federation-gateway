[
  {
    "name": "Basic Product (Single Service)",
    "query": "query ProductBase($id: ID!) { product(id: $id) { id name price inStock } }",
    "variables": { "id": "p1" },
    "expected": {
      "product": {
        "id": "p1",
        "inStock": false,
        "name": "Product p1",
        "price": 1000
      }
    }
  },
  {
    "name": "Product with Reviews (List & Federation)",
    "query": "query ProductWithReviews($id: ID!) { product(id: $id) { name price reviews { body authorName } } }",
    "variables": { "id": "p1" },
    "expected": {
      "product": {
        "name": "Product p1",
        "price": 1000,
        "reviews": [
          {
            "authorName": "Alice",
            "body": "Great product!"
          },
          {
            "authorName": "Bob",
            "body": "Not bad"
          }
        ]
      }
    }
  },
  {
    "name": "Loopback (Circular Reference: Product->Review->Product)",
    "query": "query Loopback($id: ID!) { product(id: $id) { name reviews { body product { name price } } } }",
    "variables": { "id": "p1" },
    "expected": {
      "product": {
        "name": "Product p1",
        "reviews": [
          {
            "body": "Great product!",
            "product": {
              "name": "Product 1",
              "price": 1000
            }
          },
          {
            "body": "Not bad",
            "product": {
              "name": "Product 1",
              "price": 1000
            }
          }
        ]
      }
    }
  },
  {
    "name": "Typename Check (Cross-Boundary Metadata)",
    "query": "query TypenameCheck($id: ID!) { product(id: $id) { __typename id reviews { __typename body product { __typename name } } } }",
    "variables": { "id": "p1" },
    "expected": {
      "product": {
        "__typename": "Product",
        "id": "p1",
        "reviews": [
          {
            "__typename": "Review",
            "body": "Great product!",
            "product": {
              "__typename": "Product",
              "name": "Product 1"
            }
          },
          {
            "__typename": "Review",
            "body": "Not bad",
            "product": {
              "__typename": "Product",
              "name": "Product 1"
            }
          }
        ]
      }
    }
  },
  {
    "name": "Multi Products (Alias & Root Level Parallelism)",
    "query": "query MultiProducts { p1: product(id: \"p1\") { name reviews { body } } p2: product(id: \"p2\") { name reviews { body } } }",
    "variables": {},
    "expected": {
      "p1": {
        "name": "Product p1",
        "reviews": [
          { "body": "Great product!" },
          { "body": "Not bad" }
        ]
      },
      "p2": {
        "name": "Product p2",
        "reviews": [
          { "body": "Great product!" },
          { "body": "Not bad" }
        ]
      }
    }
  },
  {
    "name": "Federation v2: @shareable Field (Product.name)",
    "query": "query { product(id: \"p1\") { id name } me { id username } }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1"
      },
      "me": {
        "id": "1",
        "username": "me"
      }
    }
  },
  {
    "name": "Federation Feature: Query Fragments",
    "description": "Verify fragment support in federated queries",
    "query": "query { product(id: \"p1\") { ...ProductFields reviews { body } } } fragment ProductFields on Product { id name price }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000,
        "reviews": [
          { "body": "Great product!" },
          { "body": "Not bad" }
        ]
      }
    }
  },
  {
    "name": "Federation Feature: Inline Fragments",
    "description": "Verify inline fragment support",
    "query": "query { product(id: \"p1\") { id ... on Product { name price } } }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000
      }
    }
  },
  {
    "name": "Federation Feature: Fragment Spread",
    "description": "Verify fragment spread support with named fragments",
    "query": "query { product(id: \"p1\") { ...ProductFields } } fragment ProductFields on Product { id name price }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000
      }
    }
  },
  {
    "name": "Federation Feature: Nested Fragments",
    "description": "Verify nested fragment expansion (fragments referencing other fragments)",
    "query": "query { product(id: \"p1\") { ...ProductWithPrice } } fragment ProductWithPrice on Product { ...BasicProduct price } fragment BasicProduct on Product { id name }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000
      }
    }
  },
  {
    "name": "Federation v2: Multiple @key Definitions (by ID)",
    "description": "Verify User entity resolution using the 'id' key",
    "query": "query { userById(id: \"user123\") { id username email } }",
    "variables": {},
    "expected": {
      "userById": {
        "id": "user123",
        "username": "user_user123",
        "email": "user123@example.com"
      }
    }
  },
  {
    "name": "Federation v2: Multiple @key Definitions (by Username)",
    "description": "Verify User entity resolution using the 'username' key",
    "query": "query { userByUsername(username: \"testuser\") { id username email } }",
    "variables": {},
    "expected": {
      "userByUsername": {
        "id": "user_id_for_testuser",
        "username": "testuser",
        "email": "testuser@example.com"
      }
    }
  },
  {
    "name": "Federation v2: Multiple @key Definitions (by Email)",
    "description": "Verify User entity resolution using the 'email' key",
    "query": "query { userByEmail(email: \"test@example.com\") { id username email } }",
    "variables": {},
    "expected": {
      "userByEmail": {
        "id": "user_id_test@example.com",
        "username": "user_for_test@example.com",
        "email": "test@example.com"
      }
    }
  },
  {
    "name": "Federation v2: Mutation Operation Type",
    "description": "Verify mutation queries use 'mutation' operation type instead of 'query'",
    "query": "mutation CreateProductTest { createProduct(name: \"Widget\", price: 100) { id name price } }",
    "variables": {},
    "expected": {
      "createProduct": {
        "id": "106",
        "name": "Widget",
        "price": 100
      }
    }
  },
  {
    "name": "Federation v2: @key(resolvable: false) - Inventory Extension",
    "description": "Verify that inventory service with resolvable: false doesn't become entity owner",
    "query": "query ProductWithInventory { product(id: \"p1\") { id name price inStock } }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000,
        "inStock": false
      }
    }
  },
  {
    "name": "Federation v2: @requires - ShippingCost Computation",
    "description": "Verify that @requires automatically fetches weight field for shippingCost calculation",
    "query": "query ProductWithShipping { product(id: \"p1\") { id name shippingCost } }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "shippingCost": 5
      }
    }
  },
  {
    "name": "Federation v2: @inaccessible - Should block access to internal fields",
    "description": "Verify that @inaccessible field cannot be queried",
    "query": "query ProductWithInternalCode { product(id: \"p1\") { id name internalCode } }",
    "variables": {},
    "expectedError": true,
    "expectedErrorMessage": "Cannot query field \"internalCode\" on type \"Product\""
  },
  {
    "name": "Federation v2: @tag - Fields with tags should work normally",
    "description": "Verify that @tag fields can be queried (tags are metadata)",
    "query": "query ProductWithTags { product(id: \"p1\") { id name price } }",
    "variables": {},
    "expected": {
      "product": {
        "id": "p1",
        "name": "Product p1",
        "price": 1000
      }
    }
  }
]